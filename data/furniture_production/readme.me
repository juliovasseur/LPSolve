## ğŸ“¦ DonnÃ©es dâ€™exemple (4 semaines)

On planifie la production de trois famillesÂ : **CH** (chaises), **TA** (tables), **DE** (bureaux). Les CSV se trouvent dans un dossier `data/`.

### 1) `variables.csv`

DÃ©clare chaque variable (borne inf/sup, type). Ex.Â :

```csv
name,low,up,type
prod_CH_w1,0,,integer
inv_CH_w1,0,,integer
back_CH_w1,0,,integer
setup_CH_w1,0,1,binary
# ... idem pour TA/DE et w1..w4
```

### 2) `objectives.csv`

DÃ©finit **lâ€™objectif** (somme de `coeff * var`) et le **sens** (min/max) ligne par ligne. ExtraitsÂ :

```csv
# Marges unitaires
prod_CH_w1,25,max
prod_TA_w1,40,max
prod_DE_w1,60,max
# CoÃ»ts de possession / backorders / setup / heures sup
inv_CH_w1,-1,max
back_CH_w1,-8,max
setup_CH_w1,-200,max
overtime_w1,-15,max
ot_carp_w1,-30,max
```

### 3) `constraints.csv`

Contraintes **lisibles** sous forme dâ€™expressions linÃ©aires. Le parser gÃ¨re les constantes Ã  gauche et les dÃ©place du bon cÃ´tÃ©. ExtraitsÂ :

```csv
# CapacitÃ©s hebdo â€” menuiserie (avec OT menuiserie)
cap_carp_w1,3*prod_CH_w1 + 5*prod_TA_w1 + 8*prod_DE_w1 -1*ot_carp_w1,<=,240
# CapacitÃ©s hebdo â€” assemblage (avec heures sup)
cap_asm_w1,2*prod_CH_w1 + 3*prod_TA_w1 + 4*prod_DE_w1 -1*overtime_w1,<=,200
# CapacitÃ©s finitionÂ / matiÃ¨re
cap_fin_w1,1*prod_CH_w1 + 2*prod_TA_w1 + 3*prod_DE_w1,<=,160
# Stockage (mÂ³)
storage_w1,inv_CH_w1 + inv_TA_w1 + inv_DE_w1,<=,200
# Liaisons productionâ†”setup (batch min / max)
link_lower_CH_w1,prod_CH_w1 -10*setup_CH_w1,>=,0
link_upper_CH_w1,prod_CH_w1 -100*setup_CH_w1,<=,0
# Ã‰quilibres inv/backlog (demande en RHS)
invbal_CH_w1,inv_CH_w1 - back_CH_w1 - prod_CH_w1,==,-40
# Budget carbone (pondÃ©ration 1/2/3 par produit)
carbon_total,1*Î£prod_CH + 2*Î£prod_TA + 3*Î£prod_DE,<=,1800
# Quota de service (contrat)
service_DE_min,Î£prod_DE,>=,30
```

> Lâ€™exemple encode des **demandes hebdo** (CHÂ : 40/50/30/60, TAÂ : 20/25/30/35, DEÂ : 10/15/20/25), des **ressources** (heures dans 3 ateliers), des **coÃ»ts** (stock, retard, setup, heures sup), un **stockage** limitÃ©, et un **budget carbone** global.

---

## ğŸ§  ModÃ¨le (vue math)

* **Variables**

  * `prod_{famille}_w{t}`Â : production entiÃ¨re
  * `inv_{famille}_w{t}`Â : stock fin de semaine
  * `back_{famille}_w{t}`Â : retard (backorder)
  * `setup_{famille}_w{t}âˆˆ{0,1}`Â : changement de sÃ©rie si production
  * `overtime_w{t}`, `ot_carp_w{t}`Â : heures sup (assemblage / menuiserie)

* **Objectif**Â : **maximiser le profit** (= marges de prod â€“ coÃ»ts de stock/retard â€“ coÃ»ts de setup â€“ coÃ»t des heures sup).

* **Contraintes (principales)**

  * **CapacitÃ©s** multiâ€‘ateliers par semaineÂ ; heures sup augmentent la capacitÃ©.
  * **Stocks / Retards**Â : Ã©quilibres inventaires avec demandes exogÃ¨nes.
  * **Setups**Â : si productionÂ â‡’ setup=1, avec **batch min/max**.
  * **Stockage**Â : volume limitÃ©.
  * **Carbone**Â : plafond global (pondÃ©rations par famille).
  * **Service**Â : quota minimal sur les bureaux (contrat client).

* **InterprÃ©tabilitÃ©** (sorties utiles)

  * **Slack** dâ€™une contrainteÂ : marge restante sur la ressource.
  * **Prix dual** (`Ï€`) dâ€™une ressource (LP)Â : **valeur marginale** dâ€™1 unitÃ© supplÃ©mentaire de capacitÃ©/carbone.
  * **CoÃ»t rÃ©duit** dâ€™une variableÂ : gain marginal net si on Â«Â entreÂ Â» cette variable dans la base.

---

## ğŸš€ DÃ©marrage

### 1) Installer CBC

* macOSÂ : `brew install coin-or-tools/coinor/cbc`
* LinuxÂ : `sudo apt-get install -y coinor-cbc`
* CondaÂ : `conda install -c conda-forge coincbc`

> Le binaire `cbc` doit Ãªtre dans le `PATH`.

### 2) DÃ©pendances Python

```bash
python -m venv .venv && source .venv/bin/activate
pip install pulp tqdm
```

### 3) Lancer

```bash
python main.py data/ -v --report lp_report
# optionsÂ : --visualize|-v, --report <dir>, --no-color
```

**Sorties console**Â : statut solveur, valeur dâ€™objectif, valeurs des variables, slacks/duals (si LP), coÃ»ts rÃ©duits.

---

## ğŸ§ª Exemple mÃ©tier expliquÃ© (cas concret)

Imaginez un **atelier de menuiserie** avec 3 gammes â€” chaises (CH), tables (TA), bureaux (DE) â€” et 3 ressources principales par semaineÂ : **menuiserie**, **assemblage**, **finition**.

* Les demandes clients sont connues sur 4 semaines.
* Chaque produit consomme X heures de chaque ressource, a une **marge unitaire** et un **profil carbone**.
* Vous pouvez **surstocker** (coÃ»t de possession), **retarder** des commandes (pÃ©nalitÃ© Â«Â backorderÂ Â»), **lancer des sÃ©ries** (coÃ»t fixe et batch min/max), faire des **heures sup** (coÃ»t).
* Un **contrat** impose un minimum de bureaux sur lâ€™horizon ; et lâ€™entreprise sâ€™est fixÃ© un **budget carbone**.

> Le modÃ¨le dÃ©cide **quoi produire**, **quand**, **en quelle quantitÃ©**, et **oÃ¹ absorber les Ã©carts** (stock vs. retard), tout en respectant les contraintes et en **maximisant le profit**.

**Impact rÃ©elÂ :**

* Identifier les **goulots** (ex. assemblage saturÃ© Ã  w2) et leur **valeur** (prix dual)Â â‡’ base pour arbitrer **heures sup** ou **investissements**.
* Mesurer le **coÃ»t dâ€™opportunitÃ©** du carbone (shadow price)Â â‡’ justification dâ€™achats de crÃ©dits carbone ou dâ€™un **mix produit** moins Ã©metteur.
* Quantifier lâ€™effet dâ€™un **setup** supplÃ©mentaire (nouvelle sÃ©rie) vs. la **taille de lot**.

---

## ğŸ—‚ï¸ Structure du repo

```
main.py                # CLI
src/lpSolver/parsing.py        # Parsing CSV + expressions linÃ©aires
src/lpSolver/model_arrays.py   # Conversion dict -> tableaux (A, b, â€¦)
src/lpSolver/lite.py           # Construction & rÃ©solution PuLP/CBC
/data/
  variables.csv
  objectives.csv
  constraints.csv
```

---

## ğŸ—ºï¸ Roadmap

*

---

## ğŸ’¼ Pourquoi câ€™est pertinent en finance

* **ModÃ©lisation contrainte**Â : traduire un mÃ©tier en variables/contraintes/objectif (compÃ©tence clÃ© des **quants** pour lâ€™allocation dâ€™actifs, funding, exÃ©cution, optimisation de collatÃ©ral, ALM).
* **DualitÃ©**Â = **prix dâ€™ombre**Â : interprÃ©tation directe en **coÃ»t du capital** ou **coÃ»t de contrainte** (rÃ¨glementaire, carbone, liquiditÃ©).
* **CoÃ»ts rÃ©duits**Â = opportunitÃ©s marginales (similaire Ã  une **alpha** nette de coÃ»ts/risques dans un univers contraint).
* **Whatâ€‘if** rapides\*\*Â : dÃ©placer un budget (carbone â†” liquiditÃ©), un quota (service â†” tracking error), ou un coÃ»t fixe (setup â†” coÃ»t de transaction) et lire lâ€™impact.

> La mÃªme mÃ©canique sert Ã  construire un **portefeuille contraint** (LP/QP), calibrer des **horaires dâ€™exÃ©cution** linÃ©arisÃ©s, ou rÃ©soudre des **problÃ¨mes dâ€™ALM** avec demandes (flux) et pÃ©nalitÃ©s (dÃ©fauts/retards).

---